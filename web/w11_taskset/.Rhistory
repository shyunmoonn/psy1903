data <- compute_rt_if_missing(data)
##summarize behavior
behavior <- summarize_behavior(data, rt_min = 300, rt_max = 900)
## esq_sum
esq_sum <- score_questionnaire(
json_string =  data[data$trialType == "questionnaire", "response"],
reverse = c(2, 5, 9),
scale_min = 0L,
scale_max = 4L
)
## combining ID, behavioral summaries, questionnaire score
oneRow <- data.frame(
subject_id = subject_id,
behavior = behavior,
esq_sum = esq_sum
)
## CSV
write.csv(
oneRow,
file = file.path("../data/cleaned/participants", paste0(subject_id, ".csv")),
row.names = FALSE
)
#### Return output ------------------------------------------------------
## stopifnot(nrow(oneRow) == 1)  # one row per participant
return(oneRow)
}
summarize_behavior <- function(data, rt_min = 300, rt_max = 900) {
## convert to logical
data$correct <- as.logical(data$correct)
## mean accuracy (proportion correct)
mean_accuracy <- mean(data$correct, na.rm = TRUE)
## data_correct object
data_correct <- data[data$correct == TRUE, ]
## mean RT on correct trials only, only 300-900ms, excluding NA
rt_filtered  <- data_correct[
data_correct$rt  >= rt_min &
data_correct$rt  <= rt_max, ]
mean_rt_correct <- mean(rt_filtered$rt, na.rm = TRUE)
## return single row data frame 'behavior'
behavior <- data.frame(
mean_rt_correct = mean_rt_correct,
mean_accuracy = mean_accuracy
)
return(behavior)
}
score_questionnaire <- function(json_string, reverse = c(2,5,9), scale_min = 0L, scale_max = 4L) {
json_string <- json_string[!is.na(json_string)]
if (length(json_string) == 0) {
return(NA_real_)
}
json_string <- json_string[1]
## ensure it's character
if(!is.character(json_string)) {
json_string <- as.character(json_string)
}
## If empty or NA, missing
if(is.na(json_string) || json_string == "" || json_string == "NA") {
return(NA_real_)
}
#### 6.1 Score ESQ-9 -----------
responses <- fromJSON(json_string)
responses <- as.numeric(unlist(responses))
rev_items <- c(2, 5, 9)
responses[rev_items] <- 4 - responses[rev_items]
## compute sum score
sum_score <- sum(responses, na.rm = TRUE)
return(sum_score)
}
#### Vectorized ----------
compute_rt_if_missing <- function(data) {
data$rt <- ifelse(
is.na(data$rt) &
!is.na(data$stim_onset_ms) &
!is.na(data$resp_time_ms) &
!is.na(data$response),
data$resp_time_ms - data$stim_onset_ms,
data$rt
)
return(data)
}
process_participant("data/raw/est-experiment-2025-11-05-09-04-45.csv")
process_participant <- function(file_path) {
## subject_id
subject_id <- sub("\\.csv$", "", basename(file_path))
## import csv file
data <- read.csv(file_path, stringsAsFactors = FALSE)
##rt if missing
data <- compute_rt_if_missing(data)
##summarize behavior
behavior <- summarize_behavior(data, rt_min = 300, rt_max = 900)
## esq_sum
esq_sum <- score_questionnaire(
json_string =  data[data$trialType == "questionnaire", "response"],
reverse = c(2, 5, 9),
scale_min = 0L,
scale_max = 4L
)
## combining ID, behavioral summaries, questionnaire score
oneRow <- data.frame(
subject_id = subject_id,
behavior = behavior,
esq_sum = esq_sum
)
## CSV
write.csv(
oneRow,
file = file.path("../data/cleaned/participants", paste0(subject_id, ".csv")),
row.names = FALSE
)
#### Return output ------------------------------------------------------
## stopifnot(nrow(oneRow) == 1)  # one row per participant
return(oneRow)
}
process_participant <- function(file_path) {
## subject_id
subject_id <- sub("\\.csv$", "", basename(file_path))
## import csv file
data <- read.csv(file_path, stringsAsFactors = FALSE)
##rt if missing
data <- compute_rt_if_missing(data)
##summarize behavior
behavior <- summarize_behavior(data, rt_min = 300, rt_max = 900)
## esq_sum
esq_sum <- score_questionnaire(
json_string =  data[data$trialType == "questionnaire", "response"],
reverse = c(2, 5, 9),
scale_min = 0L,
scale_max = 4L
)
## combining ID, behavioral summaries, questionnaire score
oneRow <- data.frame(
subject_id = subject_id,
behavior = behavior,
esq_sum = esq_sum
)
## CSV
write.csv(
oneRow,
file = file.path("../data/cleaned/participants", paste0(subject_id, ".csv")),
row.names = FALSE
)
#### Return output ------------------------------------------------------
## stopifnot(nrow(oneRow) == 1)  # one row per participant
return(oneRow)
}
process_participant("data/raw/est-experiment-2025-11-05-09-04-45.csv")
process_participant <- function(file_path) {
## subject_id
subject_id <- sub("\\.csv$", "", basename(file_path))
## import csv file
data <- read.csv(file_path, stringsAsFactors = FALSE)
##rt if missing
data <- compute_rt_if_missing(data)
##summarize behavior
behavior <- summarize_behavior(data, rt_min = 300, rt_max = 900)
## esq_sum
esq_sum <- score_questionnaire(
json_string =  data[data$trialType == "questionnaire", "response"],
reverse = c(2, 5, 9),
scale_min = 0L,
scale_max = 4L
)
## combining ID, behavioral summaries, questionnaire score
oneRow <- data.frame(
subject_id = subject_id,
behavior = behavior,
esq_sum = esq_sum
)
## CSV
write.csv(
oneRow,
file = file.path("../data/cleaned", paste0(subject_id, ".csv")),
row.names = FALSE
)
#### Return output ------------------------------------------------------
## stopifnot(nrow(oneRow) == 1)  # one row per participant
return(oneRow)
}
process_participant("data/raw/est-experiment-2025-11-05-09-04-45.csv")
process_participant <- function(file_path) {
## subject_id
subject_id <- sub("\\.csv$", "", basename(file_path))
## import csv file
data <- read.csv(file_path, stringsAsFactors = FALSE)
##rt if missing
data <- compute_rt_if_missing(data)
##summarize behavior
behavior <- summarize_behavior(data, rt_min = 300, rt_max = 900)
## esq_sum
esq_sum <- score_questionnaire(
json_string =  data[data$trialType == "questionnaire", "response"],
reverse = c(2, 5, 9),
scale_min = 0L,
scale_max = 4L
)
## combining ID, behavioral summaries, questionnaire score
oneRow <- data.frame(
subject_id = subject_id,
behavior = behavior,
esq_sum = esq_sum
)
## CSV
write.csv(
oneRow,
file = here::here("data", "cleaned", paste0(subject_id, ".csv")),
row.names = FALSE
)
#### Return output ------------------------------------------------------
## stopifnot(nrow(oneRow) == 1)  # one row per participant
return(oneRow)
}
process_participant("data/raw/est-experiment-2025-11-05-09-04-45.csv")
score_questionnaire <- function(json_string, reverse = c(2,5,9), scale_min = 0L, scale_max = 4L) {
json_string <- json_string[!is.na(json_string)]
# if (length(json_string) == 0) {
#   return(NA_real_)
# }
json_string <- json_string[1]
## ensure it's character
if(!is.character(json_string)) {
json_string <- as.character(json_string)
}
## If empty or NA, missing
if(is.na(json_string) || json_string == "" || json_string == "NA") {
return(NA_real_)
}
#### 6.1 Score ESQ-9 -----------
responses <- fromJSON(json_string)
responses <- as.numeric(unlist(responses))
rev_items <- c(2, 5, 9)
responses[rev_items] <- 4 - responses[rev_items]
## compute sum score
sum_score <- sum(responses, na.rm = TRUE)
return(sum_score)
}
process_participant("data/raw/est-experiment-2025-11-05-09-04-45.csv")
score_questionnaire <- function(json_string, reverse = c(2,5,9), scale_min = 0L, scale_max = 4L) {
json_string <- json_string[!is.na(json_string)]
# json_string <- json_string[1]
## ensure it's character
if(!is.character(json_string)) {
json_string <- as.character(json_string)
}
## If empty or NA, missing
if(is.na(json_string) || json_string == "" || json_string == "NA") {
return(NA_real_)
}
#### 6.1 Score ESQ-9 -----------
responses <- fromJSON(json_string)
responses <- as.numeric(unlist(responses))
rev_items <- c(2, 5, 9)
responses[rev_items] <- 4 - responses[rev_items]
## compute sum score
sum_score <- sum(responses, na.rm = TRUE)
return(sum_score)
}
process_participant("data/raw/est-experiment-2025-11-05-09-04-45.csv")
score_questionnaire <- function(json_string, reverse = c(2,5,9), scale_min = 0L, scale_max = 4L) {
json_string <- json_string[!is.na(json_string)]
json_string <- json_string[1]
## ensure it's character
if(!is.character(json_string)) {
json_string <- as.character(json_string)
}
## If empty or NA, missing
if(is.na(json_string) || json_string == "" || json_string == "NA") {
return(NA_real_)
}
#### 6.1 Score ESQ-9 -----------
responses <- fromJSON(json_string)
responses <- as.numeric(unlist(responses))
rev_items <- c(2, 5, 9)
responses[rev_items] <- 4 - responses[rev_items]
## compute sum score
sum_score <- sum(responses, na.rm = TRUE)
return(sum_score)
}
process_participant("data/raw/est-experiment-2025-11-05-09-04-45.csv")
score_questionnaire <- function(json_string, reverse = c(2,5,9), scale_min = 0L, scale_max = 4L) {
json_string <- json_string[!is.na(json_string)]
json_string <- json_string[1]
# ## ensure it's character
# if(!is.character(json_string)) {
#   json_string <- as.character(json_string)
# }
#
# ## If empty or NA, missing
# if(is.na(json_string) || json_string == "" || json_string == "NA") {
#   return(NA_real_)
# }
#### 6.1 Score ESQ-9 -----------
responses <- fromJSON(json_string)
responses <- as.numeric(unlist(responses))
rev_items <- c(2, 5, 9)
responses[rev_items] <- 4 - responses[rev_items]
## compute sum score
sum_score <- sum(responses, na.rm = TRUE)
return(sum_score)
}
process_participant("data/raw/est-experiment-2025-11-05-09-04-45.csv")
score_questionnaire <- function(json_string, reverse = c(2,5,9), scale_min = 0L, scale_max = 4L) {
json_string <- json_string[!is.na(json_string)]
json_string <- json_string[1]
# ## ensure it's character
# if(!is.character(json_string)) {
#   json_string <- as.character(json_string)
# }
#
## If empty or NA, missing
if(is.na(json_string) || json_string == "" || json_string == "NA") {
return(NA_real_)
}
#### 6.1 Score ESQ-9 -----------
responses <- fromJSON(json_string)
responses <- as.numeric(unlist(responses))
rev_items <- c(2, 5, 9)
responses[rev_items] <- 4 - responses[rev_items]
## compute sum score
sum_score <- sum(responses, na.rm = TRUE)
return(sum_score)
}
process_participant("data/raw/est-experiment-2025-11-05-09-04-45.csv")
score_questionnaire <- function(json_string, reverse = c(2,5,9), scale_min = 0L, scale_max = 4L) {
json_string <- json_string[!is.na(json_string)]
json_string <- json_string[1]
## If empty or NA, missing
if(json_string == "NA") {
return(NA_real_)
}
#### 6.1 Score ESQ-9 -----------
responses <- fromJSON(json_string)
responses <- as.numeric(unlist(responses))
rev_items <- c(2, 5, 9)
responses[rev_items] <- 4 - responses[rev_items]
## compute sum score
sum_score <- sum(responses, na.rm = TRUE)
return(sum_score)
}
process_participant("data/raw/est-experiment-2025-11-05-09-04-45.csv")
score_questionnaire <- function(json_string, reverse = c(2,5,9), scale_min = 0L, scale_max = 4L) {
json_string <- json_string[!is.na(json_string)]
json_string <- json_string[1]
## If empty or NA, missing
if(is.na(json_string)) {
return(NA_real_)
}
#### 6.1 Score ESQ-9 -----------
responses <- fromJSON(json_string)
responses <- as.numeric(unlist(responses))
rev_items <- c(2, 5, 9)
responses[rev_items] <- 4 - responses[rev_items]
## compute sum score
sum_score <- sum(responses, na.rm = TRUE)
return(sum_score)
}
process_participant("data/raw/est-experiment-2025-11-05-09-04-45.csv")
process_participant("data/raw/est-experiment-2025-11-05-09-04-45.csv")
score_questionnaire <- function(json_string, reverse = c(2,5,9), scale_min = 0L, scale_max = 4L) {
json_string <- json_string[!is.na(json_string)]
json_string <- json_string[1]
#### 6.1 Score ESQ-9 -----------
responses <- fromJSON(json_string)
responses <- as.numeric(unlist(responses))
rev_items <- c(2, 5, 9)
responses[rev_items] <- 4 - responses[rev_items]
## compute sum score
sum_score <- sum(responses, na.rm = TRUE)
return(sum_score)
}
process_participant("data/raw/est-experiment-2025-11-05-09-04-45.csv")
process_participant("data/raw/est-experiment-2025-11-05-09-04-45.csv")
score_questionnaire <- function(json_string, reverse = c(2,5,9), scale_min = 0L, scale_max = 4L) {
# json_string <- json_string[!is.na(json_string)]
# json_string <- json_string[1]
## If empty or NA, missing
if(is.na(json_string)) {
return(NA_real_)
}
#### 6.1 Score ESQ-9 -----------
responses <- fromJSON(json_string)
responses <- as.numeric(unlist(responses))
rev_items <- c(2, 5, 9)
responses[rev_items] <- 4 - responses[rev_items]
## compute sum score
sum_score <- sum(responses, na.rm = TRUE)
return(sum_score)
}
process_participant("data/raw/est-experiment-2025-11-05-09-04-45.csv")
score_questionnaire <- function(json_string, reverse = c(2,5,9), scale_min = 0L, scale_max = 4L) {
json_string <- json_string[!is.na(json_string)]
json_string <- json_string[1]
# ## If empty or NA, missing
# if(is.na(json_string)) {
#   return(NA_real_)
# }
#### 6.1 Score ESQ-9 -----------
responses <- fromJSON(json_string)
responses <- as.numeric(unlist(responses))
rev_items <- c(2, 5, 9)
responses[rev_items] <- 4 - responses[rev_items]
## compute sum score
sum_score <- sum(responses, na.rm = TRUE)
return(sum_score)
}
process_participant("data/raw/est-experiment-2025-11-05-09-04-45.csv")
score_questionnaire <- function(json_string, reverse = c(2,5,9), scale_min = 0L, scale_max = 4L) {
json_string <- json_string[!is.na(json_string)]
# json_string <- json_string[1]
## If NA -> missing
if(is.na(json_string)) {
return(NA_real_)
}
#### 6.1 Score ESQ-9 -----------
responses <- fromJSON(json_string)
responses <- as.numeric(unlist(responses))
rev_items <- c(2, 5, 9)
responses[rev_items] <- 4 - responses[rev_items]
## compute sum score
sum_score <- sum(responses, na.rm = TRUE)
return(sum_score)
}
process_participant("data/raw/est-experiment-2025-11-05-09-04-45.csv")
score_questionnaire <- function(json_string, reverse = c(2,5,9), scale_min = 0L, scale_max = 4L) {
json_string <- json_string[!is.na(json_string)]
# json_string <- json_string[1]
## If NA -> missing
# if(is.na(json_string)) {
#   return(NA_real_)
# }
#### 6.1 Score ESQ-9 -----------
responses <- fromJSON(json_string)
responses <- as.numeric(unlist(responses))
rev_items <- c(2, 5, 9)
responses[rev_items] <- 4 - responses[rev_items]
## compute sum score
sum_score <- sum(responses, na.rm = TRUE)
return(sum_score)
}
process_participant("data/raw/est-experiment-2025-11-05-09-04-45.csv")
score_questionnaire <- function(json_string, reverse = c(2,5,9), scale_min = 0L, scale_max = 4L) {
json_string <- json_string[!is.na(json_string)]
json_string <- json_string[1]
## If NA -> missing
if(is.na(json_string)) {
return(NA_real_)
}
#### 6.1 Score ESQ-9 -----------
responses <- fromJSON(json_string)
responses <- as.numeric(unlist(responses))
rev_items <- c(2, 5, 9)
responses[rev_items] <- 4 - responses[rev_items]
## compute sum score
sum_score <- sum(responses, na.rm = TRUE)
return(sum_score)
}
process_participant("data/raw/est-experiment-2025-11-05-09-04-45.csv")
process_participant <- function(file_path) {
## subject_id
subject_id <- sub("\\.csv$", "", basename(file_path))
## import csv file
data <- read.csv(file_path, stringsAsFactors = FALSE)
##rt if missing
data <- compute_rt_if_missing(data)
##summarize behavior
behavior <- summarize_behavior(data, rt_min = 300, rt_max = 900)
## esq_sum
esq_sum <- score_questionnaire(
json_string =  data[data$trialType == "questionnaire", "response"],
reverse = c(2, 5, 9),
scale_min = 0L,
scale_max = 4L
)
## combining ID, behavioral summaries, questionnaire score
oneRow <- data.frame(
subject_id = subject_id,
behavior = behavior,
esq_sum = esq_sum
)
## CSV
write.csv(
oneRow,
file = here::here("data", "cleaned", paste0(subject_id, "_processed.csv")),
row.names = FALSE
)
#### Return output ------------------------------------------------------
stopifnot(nrow(oneRow) == 1)  # one row per participant
return(oneRow)
}
process_participant("data/raw/est-experiment-2025-11-05-09-04-45.csv")
#### Load functions --------------------------------------------------
```{r}
traceback()
source("../scripts/score_questionnaire.R")
source("../scripts/summarize_behavior.R")
source("../scripts/process_participant.R")
file_list <- list.files(
here::here("data", "raw"),
pattern = "^est-experiment-.*\\.csv$",
full.names = TRUE
)
participant_rows <- lapply(file_list, process_participant)
study_level <- do.call(rbind, participant_rows)
source("../scripts/score_questionnaire.R")
source("../scripts/summarize_behavior.R")
source("../scripts/process_participant.R")
file_list <- list.files(
here::here("data", "raw"),
pattern = "^est-experiment-.*\\.csv$",
full.names = TRUE
)
participant_rows <- lapply(file_list, process_participant)
study_level <- do.call(rbind, participant_rows)
